<div class="container mt-5">
  <br><br>
  <h2 class="mb-4">Campaigns List</h2>

  <table class="table">
    <thead class="thead-dark">
      <tr>
        <th scope="col"></th>
        <th scope="col">Campaign Creator</th>
        <th scope="col">Campaign Name</th>
        <th scope="col">Target Fund</th>
        <th scope="col">Current Raised</th>
        <th scope="col">Start Date</th>
        <th scope="col">End Date</th>
        <th scope="col">Status</th>
        <th scope="col">Approval Status</th>
        <th scope="col">Proof Files</th>
        <th scope="col">Notes </th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let campaign of campaigns" (click)="showCampaignDetails(campaign)" style="cursor: pointer;">
        <td><input type="checkbox"></td>
        <td>{{ campaign.acc_firstname }}{{ campaign.acc_lastname }}</td>
        <td>{{ campaign.Campaign_Name }}</td>
        <td>{{ campaign.Campaign_TargetFund | currency }}</td>
        <td>{{ campaign.Campaign_CurrentRaised | currency }}</td>
        <td>{{ campaign.Campaign_Start | date:'MM/dd/yyyy' }}</td>
        <td>{{ campaign.Campaign_End | date:'MM/dd/yyyy' }}</td>
        <td>{{ getCampaignStatus(campaign.Campaign_Status) }}</td>
        <td>{{ campaign.Campaign_ApprovalStatus }}</td>
        <td>
          <button class="btn btn-primary btn-sm mt-2" (click)="viewAllImages(imageModal, campaign); $event.stopPropagation()">View Proofs</button>
        </td>
        <td><button class="btn btn-primary btn-sm mt-2" (click)="openNotesModal(campaign.Campaign_ID); $event.stopPropagation()">View Notes</button></td>
        <td>
          <div class="actions">
            <button [disabled]="loading" class="btn btn-success btn-sm" (click)="approveCampaign(campaign.Campaign_ID); $event.stopPropagation()"><span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
              Approve</button>
            <button [disabled]="loading" class="btn btn-danger btn-sm" (click)="openRejectionModal(campaign.Campaign_ID, rejectionModal); $event.stopPropagation()"><span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
              Reject</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<ng-template #rejectionModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Reject Campaign</h5>
    <button type="button" class="btn-close" (click)="modal.close()"></button>
  </div>
  <div class="modal-body">
    <textarea [(ngModel)]="rejectionNote" class="form-control" rows="3" placeholder="Enter the reason for rejection"></textarea>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close()">Cancel</button>
    <button type="button" class="btn btn-danger" (click)="confirmRejectCampaign(selectedCampaignId, modal)">Reject</button>
  </div>
</ng-template>

<ng-template #imageModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Campaign Images</h5>
    <button type="button" class="close" aria-label="Close" (click)="modal.close()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div *ngFor="let image of selectedCampaignImages">
      <img [src]="'http://localhost:4000/assets/' + image" alt="Campaign Image" style="width: 100%; height: auto; margin-bottom: 10px;">
    </div>
  </div>
</ng-template>

<ng-template #notesModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">User Notes</h5>
    <button type="button" class="btn-close" (click)="closeModal(modal)"></button>
  </div>
  <div class="modal-body">
    <p *ngIf="selectedNote">{{ selectedNote }}</p>
    <p *ngIf="!selectedNote">No note available for this campaign.</p>
  </div>
</ng-template>

<ng-template #detailsModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Campaign Details</h5>
    <button type="button" class="btn-close" (click)="modal.close()"></button>
  </div>
  <div class="modal-body">
    <img [src]="'http://localhost:4000/assets/' + campaign.Campaign_Image">
    <p><strong>Creator:</strong> {{ campaign?.acc_firstname }} {{ campaign?.acc_lastname }}</p>
    <p><strong>Name:</strong> {{ campaign?.Campaign_Name }}</p>
    <p><strong>Description:</strong> {{ campaign?.Campaign_Description }}</p>
    <p><strong>Target Fund:</strong> {{ campaign?.Campaign_TargetFund | currency }}</p>
    <p><strong>Current Raised:</strong> {{ campaign?.Campaign_CurrentRaised | currency }}</p>
    <p><strong>Start Date:</strong> {{ campaign?.Campaign_Start | date:'MM/dd/yyyy' }}</p>
    <p><strong>End Date:</strong> {{ campaign?.Campaign_End | date:'MM/dd/yyyy' }}</p>
    <p><strong>Status:</strong> {{ getCampaignStatus(campaign?.Campaign_Status) }}</p>
    <p><strong>Approval Status:</strong> {{ campaign?.Campaign_ApprovalStatus }}</p>
    <p><strong>Notes:</strong> {{ campaign?.Campaign_Notes }}</p>
  </div>
</ng-template>


